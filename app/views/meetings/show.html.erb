<%# Path: app/views/meetings/show.html.erb %>

<h1><%= @meeting.name %></h1>
<p><%= @meeting.description%> </p>
<p> public: <%= @meeting.is_public%> </p>
<p> Zoom Link: <%= @meeting.zoom_link%> </p>
<p>
  Meeting starts <%= time_ago_in_words(@meeting.start_time) %>
  (at <%= @meeting.start_time.strftime("%A, %B %e, %Y at %l:%M %p") %>)
</p>


<h2>Invitees</h2>
<% if @meeting.invitee_emails_array.any? %>
  <ul>
    <% @meeting.invitee_emails_array.each do |email| %>
      <li><%= email %></li>
      <% invitation = @meeting.invitations.find_by(user_id: User.find_by(email: email)) %>
      <% if invitation.present? %>
        <% if invitation.accepted? %>
          <span class="status accepted">Accepted</span>
        <% elsif invitation.rejected? %>
          <span class="status rejected">Rejected</span>
        <% else %>
          <span class="status pending">Pending</span>
        <% end %>
      <% else %>
        <span class="status not-registered">Not Registered</span>
      <% end %>
    <% end %>
  </ul>
<% else %>
  <p>No invitees yet.</p>
<% end %>

<h2>Invite Others</h2>
<%= form_with(model: @meeting, url: invite_meeting_path(@meeting), method: :patch) do |form| %>
  <div class="form-group">
    <%= form.label :invitee_email %>
    <%= form.email_field :invitee_email, class: 'form-control' %>
  </div>

  <%= form.submit 'Invite', class: 'btn btn-primary' %>
<% end %>

